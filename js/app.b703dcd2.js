(function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dev-challenge-xvii-online/",i(i.s=0)})({0:function(t,e,i){t.exports=i("56d7")},"56d7":function(t,e,i){"use strict";i.r(e);const s={GAME_WIDTH:1e3,GAME_HEIGHT:600,SCALE:2,SPEED_SCALE:1.5,BACKGROUND_HEIGHT:50,MIN_POWER:200,MAX_POWER:400,MIN_ANGLE:-10,MAX_ANGLE:-69,G:9.81,IMPULSE_LOSS_RATIO:.75,CAMERA_PADDING:500};s.WALL_HEIGHT=s.GAME_HEIGHT-s.BACKGROUND_HEIGHT-150,s.WALL_WIDTH=150,s.HUD_X=s.GAME_WIDTH,s.HUD_Y=0;const a={canvas:null,isPlaying:!1,isFalling:!1,isGameOver:!1,gameSpeed:2,angle:45,power:150,pauseAngle:0,pausePower:0,y0:s.GAME_HEIGHT-s.BACKGROUND_HEIGHT-150,x0:75,wallX:2600,initialCameraX:s.CAMERA_PADDING,cameraX:0},h=()=>{Object.assign(r,{...a,canvas:r.canvas})},r={...a};class o{constructor(t){this.x=t.x||0,this.y=t.y||0,this.ctx=t.ctx,this.rotation=0,this.isMousePressed=!1}_getMouseCoords(t){const e=r.canvas.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top;return{x:i,y:s}}_getRotatedCoordinates(t,e,i,s,a){const h=this._degToRad(Math.round(a||this.rotation));return{x:Math.round(t+(i-t)*Math.cos(h)-(s-e)*Math.sin(h)),y:Math.round(e+(s-e)*Math.cos(h)+(i-t)*Math.sin(h))}}isMouseOverElement(t,e,i){const s=this._getMouseCoords(t).x,a=this._getMouseCoords(t).y,h=this._getRotatedCoordinates(e,i,this.x,this.y),r=this._getRotatedCoordinates(e,i,this.x+this.width,this.y),o=this._getRotatedCoordinates(e,i,this.x,this.y+this.height),n=this._getRotatedCoordinates(e,i,this.x+this.width,this.y+this.height),d=(h.x-s)*(o.y-h.y)-(o.x-h.x)*(h.y-a),c=(o.x-s)*(r.y-o.y)-(r.x-o.x)*(o.y-a),l=(r.x-s)*(h.y-r.y)-(h.x-r.x)*(r.y-a),g=(n.x-s)*(o.y-n.y)-(o.x-n.x)*(n.y-a),u=(r.x-s)*(n.y-r.y)-(n.x-r.x)*(r.y-a);return d<=0&&c<=0&&l<=0||d>=0&&c>=0&&l>=0||g<=0&&c<=0&&u<=0||g>=0&&c>=0&&u>=0}_onMouseDown(t){this.isMouseOverElement(t)&&(this.isMousePressed=!0)}_radToDeg(t){return 180*t/Math.PI}_degToRad(t){return t*Math.PI/180}_onMouseUp(){this.isMousePressed=!1}}const n=s.GAME_HEIGHT-s.BACKGROUND_HEIGHT;class d extends o{constructor(t,e){super(t,e),this.rocketImageReady=!1,this.rocketIdleImageReady=!1,this.rocket=new Image,this.rocketIdle=new Image,this.rocket.onload=()=>{this.rocketImageReady=!0},this.rocketIdle.onload=()=>{this.rocketIdleImageReady=!0},this.rocket.src="./images/rocket.png",this.rocketIdle.src="./images/rocket_idle.png",this.x0=r.x0,this.y0=r.y0,this.t=0,this.rotation=-r.angle,this.width=150,this.height=150,this.control=_.find("control"),this.wall=_.find("wall"),this.maxY=this.center.y,r.canvas.addEventListener("mousedown",this._onMouseDown.bind(this)),window.addEventListener("mouseup",this._onMouseUp.bind(this)),window.addEventListener("mousemove",this.onMouseMove.bind(this))}get center(){const t=this.x+this.width/2,e=this.y;this.rotation+=90;const i=this._getRotatedCoordinates(t,e,this.x+this.width/2,this.y+this.height/2,this.rotation);return this.rotation-=90,i}isMouseOverElement(t,e=this.x+this.width/2,i=this.y){this.rotation+=90;const s=super.isMouseOverElement(t,e,i);return this.rotation-=90,s}onMouseMove(t){if(this.isMouseOverElement(t)?r.canvas.style.cursor="pointer":r.canvas.style.cursor="default",this.isMousePressed&&!r.isPlaying){const e=this._getMouseCoords(t).y-this.height/2;if(e>s.GAME_HEIGHT-s.BACKGROUND_HEIGHT-this.height/2||e<200)return;this.y0=this._getMouseCoords(t).y-this.height/2,this.y=this.y0}}reset(){this.x0=this.x,this.y0=this.y,this.t=0}move(t){let e=this._degToRad(r.angle);const i=this.x0+r.power*Math.cos(e)*this.t*(1/s.SCALE),a=this.y0-(r.power*Math.sin(e)*this.t-s.G*this.t*this.t/2)*(1/s.SCALE);this.rotation=this._radToDeg(Math.atan((a-this.y)/(i-this.x))),this.x=i,this.y=a,r.isPlaying&&(this.t+=t*s.SCALE);const h=r.power*r.power*Math.sin(2*e)/s.G;this.Lmax!==h&&(this.Lmax=h,this.Lmax<this.width)?this.gameOver():(this.center.y<this.maxY&&(this.maxY=this.center.y),this.center.y+this.height/3>n&&(this.y0=n-this.height,this.x0=this.x,this.t=0,r.power*=s.IMPULSE_LOSS_RATIO))}fall(t){let e=this._degToRad(r.angle);this.y=this.y0-(r.power*Math.sin(e)*this.t-s.G*this.t*this.t/2)*(1/s.SCALE),this.t+=t*s.SCALE,this.center.y+this.height/4>n&&(r.gameSpeed=0)}rotate(){this.rotation&&(this.ctx.translate(this.x-r.cameraX+this.width/2,this.y),this.ctx.rotate(this._degToRad(this.rotation+90)),this.ctx.translate(-this.x+r.cameraX-this.width/2,-this.y))}checkWallCollision(){this.center.x+this.width/4>=this.wall.x&&this.center.x-this.width/4<=this.wall.x+this.wall.width&&this.center.y>=s.GAME_HEIGHT-this.wall.height&&this.gameOver()}cameraMove(){this.x>r.canvas.width-s.CAMERA_PADDING?r.cameraX=this.x-r.canvas.width+s.CAMERA_PADDING:r.cameraX=0}gameOver(){r.isPlaying=!1,r.isFalling=!0,r.isGameOver=!0,window.dispatchEvent(new CustomEvent("gameover"))}render(t){this.rocketIdleImageReady&&this.rocketImageReady&&(this.control||(this.control=_.find("control")),r.isPlaying?(this.move(t),this.cameraMove()):r.isFalling&&this.fall(t),this.checkWallCollision(),this.rotate(),r.isPlaying?this.ctx.drawImage(this.rocket,this.x-r.cameraX,this.y,150,150):this.ctx.drawImage(this.rocketIdle,this.x-r.cameraX,this.y,150,150),this.ctx.setTransform(1,0,0,1,0,0))}}class c extends o{constructor(t,e){super(t,e),this.imageReady=!1,this.image=new Image,this.image.onload=()=>this.imageReady=!0,this.image.src="./images/arrow.png",this.rotation=-r.angle,this.width=r.power,this.height=r.power,this.rocket=_.find("rocket"),r.canvas.addEventListener("mousedown",this._onMouseDown.bind(this)),r.canvas.addEventListener("mouseup",this._onMouseUp.bind(this)),r.canvas.addEventListener("mousemove",this.onMouseMove.bind(this))}isMouseOverElement(t){const e=this.x,i=this.y+this.height/2;return super.isMouseOverElement(t,e,i)}onMouseMove(t){if(this.isMouseOverElement(t)?r.canvas.style.cursor="pointer":r.canvas.style.cursor="default",this.isMousePressed&&!r.isPlaying){let e=this._getMouseCoords(t).x-this.x,i=this._getMouseCoords(t).y-this.y-this.height/2;if(e<0||i>0)return;const a=Math.abs(Math.sqrt(e*e+i*i));if(a>s.MIN_POWER&&a<s.MAX_POWER){const t=Math.round(a);this.width=t,r.power=t}const h=Math.round(this._radToDeg(Math.atan(i/Math.abs(e))));h<s.MAX_ANGLE?this.rotation=s.MAX_ANGLE:h>s.MIN_ANGLE?this.rotation=s.MIN_ANGLE:this.rotation=h,r.angle=Math.abs(this.rotation)}}rotate(){this.rotation<s.MAX_ANGLE||this.rotation>s.MIN_ANGLE||(this.ctx.translate(this.x,this.y+this.height/2),this.ctx.rotate(this.rotation?this._degToRad(this.rotation):0),this.ctx.translate(-this.x,-this.y-this.height/2))}moveToRocket(){this.x=this.rocket.x-r.cameraX+10+this.height/2,this.y=this.rocket.y-this.height/2}reset(){this.width=r.power}render(){this.imageReady&&(r.isPlaying||r.isGameOver||(this.moveToRocket(),this.rotate(),this.ctx.drawImage(this.image,this.x,this.y,this.width,this.height),this.ctx.setTransform(1,0,0,1,0,0)))}}const l="./images/background/clouds_1.png",g="./images/background/clouds_2.png",u="./images/background/sky.png",m="./images/background/rocks.png",y="./images/floor.png";function x(t,e=1){const i=new Image,s={img:i,speed:e,ready:!1};return i.src=t,i.onload=()=>{s.ready=!0},s}class w extends o{constructor(t){super(t),this.sky=x(u,.5),this.nearClouds=x(l,1.5),this.farClouds=x(g,1.1),this.rocks=x(m,1.3),this.floor=x(y)}getX(t,e=!1){return-r.cameraX*t.speed%this.ctx.canvas.width+(e?this.ctx.canvas.width:0)}drawFloor(){this.floor.ready&&(this.ctx.drawImage(this.floor.img,this.getX(this.floor),550,this.ctx.canvas.width,50),this.ctx.drawImage(this.floor.img,this.getX(this.floor,!0),550,this.ctx.canvas.width,50))}drawSky(){this.sky.ready&&(this.ctx.drawImage(this.sky.img,this.getX(this.sky),this.y,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.drawImage(this.sky.img,this.getX(this.sky,!0),this.y,this.ctx.canvas.width,this.ctx.canvas.height))}drawFarClouds(){this.farClouds.ready&&(this.ctx.drawImage(this.farClouds.img,this.getX(this.farClouds),this.y,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.drawImage(this.farClouds.img,this.getX(this.farClouds,!0),this.y,this.ctx.canvas.width,this.ctx.canvas.height))}drawNearClouds(){this.nearClouds.ready&&(this.ctx.drawImage(this.nearClouds.img,this.getX(this.nearClouds),this.y,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.drawImage(this.nearClouds.img,this.getX(this.nearClouds,!0),this.y,this.ctx.canvas.width,this.ctx.canvas.height))}drawRocks(){this.rocks.ready&&(this.ctx.drawImage(this.rocks.img,this.getX(this.rocks),this.y,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.drawImage(this.rocks.img,this.getX(this.rocks,!0),this.y,this.ctx.canvas.width,this.ctx.canvas.height))}render(){this.drawSky(),this.drawFarClouds(),this.drawRocks(),this.drawNearClouds(),this.drawFloor()}}class p extends o{constructor(t,e){super(t,e),this.imageReady=!1,this.image=new Image,this.height=s.WALL_HEIGHT,this.width=s.WALL_WIDTH,this.image.onload=()=>{this.imageReady=!0},this.image.src="./images/wall.png"}render(){this.imageReady&&this.ctx.drawImage(this.image,this.x-r.cameraX,this.y,this.width,this.height)}}class M extends o{constructor(t,e){super(t,e),this.width=200,this.height=200,this.image=new Image,this.image.onload=()=>{this.imageReady=!0},this.image.src="./images/gui.png",this.lineHeight=30,this.color="white",this.keyFont="15px Arial",this.valueFont="22px Arial",this.keyPadding=80,this.valuePadding=10,this.rocket=null}drawKey(t,e){this.ctx.font=this.keyFont,this.ctx.fillText(t,this.x-this.keyPadding,this.y+e*this.lineHeight)}drawValue(t,e){this.ctx.font=this.valueFont,this.ctx.fillText(t,this.x-this.valuePadding,this.y+e*this.lineHeight)}render(){this.rocket||(this.rocket=_.find("rocket")),this.imageReady&&(this.ctx.drawImage(this.image,this.x-this.width,this.y,this.width,this.height),this.ctx.fillStyle=this.color,this.ctx.textAlign="right",this.drawKey("Current distance",1),this.drawValue(Math.round(this.rocket.x),1),this.drawKey("Current altitude",2),this.drawValue(Math.round(s.GAME_HEIGHT-s.BACKGROUND_HEIGHT-this.rocket.center.y),2),this.drawKey("Max altitude",3),this.drawValue(Math.round(s.GAME_HEIGHT-s.BACKGROUND_HEIGHT-this.rocket.maxY),3),this.drawKey("Angle",4),this.drawValue(Math.round(r.angle),4),this.drawKey("Power",5),this.drawValue(Math.round(r.power),5),this.drawKey("Time from launch",6),this.drawValue(Math.round(this.rocket.t||0),6))}}class v{constructor(){this.structure=[{name:"background",className:w,properties:{x:0,y:0}},{name:"wall",className:p,properties:{x:r.wallX,y:s.GAME_HEIGHT-s.WALL_HEIGHT}},{name:"rocket",className:d,properties:{x:r.x0,y:r.y0}},{name:"control",className:c,properties:{x:r.x0,y:r.y0}},{name:"hud",className:M,properties:{x:s.HUD_X,y:s.HUD_Y}}]}find(t){return this.structure.find(e=>e.name===t).gameObject}initialize(){this.structure.map(t=>{t.gameObject=new t.className({...t.properties,ctx:r.canvas.getContext("2d")})})}clear(){this.structure.map(t=>{delete t.gameObject})}render(t){this.structure.map(e=>{e.gameObject&&e.gameObject.render(t)})}}const _=new v,E={playPause:document.querySelector("#playPause"),playAgain:document.querySelector("#playAgain"),speed1:document.querySelector("#speed-1"),speed2:document.querySelector("#speed-2"),speed3:document.querySelector("#speed-3"),speedContainer:document.querySelector("#speedContainer")};function A(){[...E.speedContainer.querySelectorAll("button"),E.playPause].map(t=>t.disabled=!1),E.playAgain.disabled=!0,E.speed2.disabled=!0}let I,f;E.playPause.addEventListener("click",()=>{r.isPlaying?(r.oldAngle=r.angle,r.oldPower=r.power,r.isPlaying=!1):(r.isPlaying=!0,r.angle===r.oldAngle&&r.power===r.oldPower||(_.find("rocket").reset(),_.find("control").reset()))}),E.playAgain.addEventListener("click",()=>{_.clear(),h(),_.initialize(),A()}),E.speedContainer.addEventListener("click",t=>{"BUTTON"===t.target.nodeName&&([...E.speedContainer.querySelectorAll("button")].map(t=>t.disabled=!1),t.target.disabled=!0,r.gameSpeed=+t.target.id.split("-")[1])}),window.addEventListener("gameover",()=>{[...E.speedContainer.querySelectorAll("button"),E.playPause].map(t=>t.disabled=!0),E.playAgain.disabled=!1});let k=0,C=0;function G(){I=document.getElementById("game"),f=I.getContext("2d"),I.setAttribute("width",String(s.GAME_WIDTH)),I.setAttribute("height",String(s.GAME_HEIGHT)),r.canvas=I,_.initialize(f),window.requestAnimationFrame(H)}function H(t){k=(t-C)/1e3,C=t,R(k),requestAnimationFrame(H)}function R(t){f&&(f.clearRect(0,0,I.width,I.height),_.render(t*r.gameSpeed*s.SPEED_SCALE))}window.onload=G,requestAnimationFrame(H)}});
//# sourceMappingURL=app.b703dcd2.js.map